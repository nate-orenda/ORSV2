@page
@model ORSV2.Pages.Districts.IndexModel
@using ORSV2.Models

@{
    ViewData["Title"] = "Districts";
    bool canEdit = User.IsInRole("OrendaAdmin") || User.IsInRole("OrendaManager");
}

<h1>Districts</h1>

@if (canEdit)
{
    <p>
        <a asp-page="Create" class="btn btn-primary btn-sm">Create New District</a>
    </p>
}

<table class="table table-striped align-middle">
    <thead>
        <tr>
            <th>Name</th>
            <th>CDS Code</th>
            <th class="text-center">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var district in Model.Districts)
        {
            <tr>
                <td>
                    @district.Name
                    @if (!string.IsNullOrWhiteSpace(district.Notes))
                    {
                        <span class="ms-1 text-muted"
                              data-bs-toggle="tooltip"
                              title="@district.Notes">
                            <i class="bi bi-info-circle"></i>
                        </span>
                    }
                </td>
                <td>@district.CDSCode</td>
                <td>
                    <div class="d-flex flex-wrap gap-2">
                        <a asp-page="/Schools/Index"
                           asp-route-districtId="@district.Id"
                           class="btn btn-outline-primary btn-sm">
                            View Schools
                        </a>

                        <a asp-page="/Courses/Index"
                           asp-route-districtId="@district.Id"
                           class="btn btn-outline-primary btn-sm">
                            View Courses
                        </a>

                        <a asp-page="/Districts/CheckpointSchedules"
                           asp-route-DistrictId="@district.Id"
                           class="btn btn-outline-primary btn-sm">
                            Edit Checkpoint Dates
                        </a>

                        @if (canEdit)
                        {
                            <a asp-page="/Districts/RunImports"
                               asp-route-districtId="@district.Id"
                               class="btn btn-outline-primary btn-sm">
                                Run Imports
                            </a>

                            <a asp-page="Edit"
                               asp-route-id="@district.Id"
                               class="btn btn-outline-primary btn-sm">
                                Edit
                            </a>

                            <a asp-page="Delete"
                               asp-route-id="@district.Id"
                               class="btn btn-outline-danger btn-sm">
                                Delete
                            </a>
                        }
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        // Initialize Bootstrap tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>
}
